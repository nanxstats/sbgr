<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Easy API: A User-Friendly Cascading API • sbgr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Easy API: A User-Friendly Cascading API">
<meta property="og:description" content="sbgr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sbgr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/sbgr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/easy-api.html">Easy API: A User-Friendly Cascading API</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/nanxstats/sbgr/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="easy-api_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Easy API: A User-Friendly Cascading API</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nanxstats/sbgr/blob/master/vignettes/easy-api.Rmd"><code>vignettes/easy-api.Rmd</code></a></small>
      <div class="hidden name"><code>easy-api.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This “easy API” is built on lower level R API function calls provided by this package, (please check the other tutorial and manual) but with a more user friendly interface that provides</p>
<ul>
<li>Simpler cascading style from a <em>Auth</em> object or its children, for example</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## download a file</span>
<span class="va">a</span><span class="op">$</span><span class="fu">project</span><span class="op">(</span><span class="st">"wgs"</span><span class="op">)</span><span class="op">$</span><span class="fu">file</span><span class="op">(</span><span class="st">"17.vcf"</span><span class="op">)</span><span class="op">$</span><span class="fu">download</span><span class="op">(</span><span class="op">)</span>
<span class="co">## upload a file</span>
<span class="va">a</span><span class="op">$</span><span class="fu">project</span><span class="op">(</span><span class="st">"wgs"</span><span class="op">)</span><span class="op">$</span><span class="fu">upload</span><span class="op">(</span><span class="st">"sample.tgz"</span><span class="op">)</span></code></pre></div>
<ul>
<li>Exact matching or fuzz matching by names and id.</li>
<li>Actions for each different objects</li>
<li>Nice print format than a long list</li>
<li>Return an R5 object in stead of a list</li>
<li>Extensible with more actions</li>
</ul>
<p>We defined several different objects easy to manipulate, including <em>Auth</em>, <em>Project</em>, <em>Task</em>, <em>File</em>, <em>Upload</em>, <em>Member</em>, etc, each comes with their own methods to access the server, send request and get a response.</p>
<p>To understand the cascading style, you has to under stand the structure of the SBG platforms.</p>
<ul>
<li>Each account could generate one auth token, it’s our top level object.</li>
<li>Each account has several different projects represented by <em>Project</em> object</li>
<li>Each account had different billing group and each project is assigned to particular billing group in order to run on AWS cloud.</li>
<li>Each project is composed with files (<em>File</em> object), tasks (<em>Task</em> object), pipelines (<em>Pipeline</em> object) and members or users (<em>Member</em> object) with different permission level.</li>
<li>Each member has its own permission to particular project.</li>
<li>A task is a scheduled pipeline job with files and parameters.</li>
</ul>
<p>So our cascading visually represent this relationship and structure, if you are familiar with SBG platform, you will find this interface very easy to understand.</p>
<p>To understand the API better, you can also check the original SBG developer hub <a href="https://docs.sbgenomics.com/display/developerhub/API">documents</a></p>
<div id="cheatsheet" class="section level2">
<h2 class="hasAnchor">
<a href="#cheatsheet" class="anchor"></a>Cheatsheet</h2>
<p>This cheat sheet provide main API designed for end users, please note “single” is not real project name, just means the cascading method expecting a single returned object not a list, so you name better has a single hit or you pick the one you want from the list. Remember the logic structure and relationship of those concept will help you remember the API easily. For example, a project has members so of course you can run member() method on project object.</p>
<p>For a searching function that need name or id, when both are empty, they will return every object (file, project, pipeline, task, member) in a list. These function usually has optional parameter called <code>ignore.case</code> and <code>exact</code> used for matching, when <code>exact = FALSE</code> you can use pattern to grep objects.</p>
<p>The cheat sheet only show some most used arguments, please check their help function to read more details.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Auth-class.html">Auth</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">a</span><span class="op">$</span><span class="fu">billing</span><span class="op">(</span><span class="op">)</span>
<span class="va">a</span><span class="op">$</span><span class="fu">project_new</span><span class="op">(</span>name <span class="op">=</span> , description <span class="op">=</span> , billing_group_id <span class="op">=</span> <span class="op">)</span>
<span class="va">a</span><span class="op">$</span><span class="fu">project</span><span class="op">(</span>repos <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"public"</span>, <span class="st">"my"</span>, <span class="st">"project"</span><span class="op">)</span>, project_name <span class="op">=</span> , project_id <span class="op">=</span> <span class="op">)</span>
<span class="co">## to save some typing</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">$</span><span class="fu">project</span><span class="op">(</span><span class="st">"single"</span><span class="op">)</span>
<span class="va">p</span><span class="op">$</span><span class="fu">delete</span><span class="op">(</span><span class="op">)</span>
<span class="va">p</span><span class="op">$</span><span class="fu">member</span><span class="op">(</span>name <span class="op">=</span> , id <span class="op">=</span> <span class="op">)</span>
<span class="va">p</span><span class="op">$</span><span class="fu">member_add</span><span class="op">(</span><span class="op">)</span>
<span class="va">p</span><span class="op">$</span><span class="fu">member_update</span><span class="op">(</span><span class="op">)</span>
<span class="va">p</span><span class="op">$</span><span class="fu">member_delete</span><span class="op">(</span><span class="op">)</span>
<span class="va">p</span><span class="op">$</span><span class="fu">file</span><span class="op">(</span>name <span class="op">=</span> , id <span class="op">=</span> <span class="op">)</span>
<span class="va">p</span><span class="op">$</span><span class="fu">file</span><span class="op">(</span><span class="st">"single"</span><span class="op">)</span><span class="op">$</span><span class="fu">download</span><span class="op">(</span><span class="op">)</span>
<span class="va">p</span><span class="op">$</span><span class="fu">upload</span><span class="op">(</span>file <span class="op">=</span> , metadata <span class="op">=</span> <span class="op">)</span>
<span class="va">p</span><span class="op">$</span><span class="fu">pipeline</span><span class="op">(</span>name <span class="op">=</span> , id <span class="op">=</span> <span class="op">)</span>
<span class="va">p</span><span class="op">$</span><span class="fu">pipeline_add</span><span class="op">(</span><span class="op">)</span>
<span class="va">p</span><span class="op">$</span><span class="fu">task</span><span class="op">(</span>name <span class="op">=</span> , id <span class="op">=</span> <span class="op">)</span>
<span class="va">p</span><span class="op">$</span><span class="fu">task_run</span><span class="op">(</span><span class="op">)</span>
<span class="va">p</span><span class="op">$</span><span class="fu">task</span><span class="op">(</span><span class="st">"single"</span><span class="op">)</span><span class="op">$</span><span class="fu">abort</span><span class="op">(</span><span class="op">)</span>
<span class="va">p</span><span class="op">$</span><span class="fu">task</span><span class="op">(</span><span class="st">"single"</span><span class="op">)</span><span class="op">$</span><span class="fu">monitor</span><span class="op">(</span>time <span class="op">=</span> <span class="op">)</span></code></pre></div>
<p>So you can do a cascading like this, it reads like “I want download the file sample1.tgz in project API under account a”</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a</span><span class="op">$</span><span class="fu">project</span><span class="op">(</span><span class="st">"API"</span><span class="op">)</span><span class="op">$</span><span class="fu">file</span><span class="op">(</span><span class="st">"sample1.tgz"</span><span class="op">)</span><span class="op">$</span><span class="fu">download</span><span class="op">(</span><span class="st">"~/Desktop/"</span><span class="op">)</span></code></pre></div>
<p>Please play the main function yourself, we are not covering all the function in this tutorial. Also some users may notice the object actually has lower level API binding as well for example, you can call <code>a$pipeline_list_project()</code> but those are used internally not supposed to be used by end users. user can just call <code>a$prject("public")</code></p>
</div>
</div>
<div id="quick-start-running-the-fastqc-pipeline" class="section level1">
<h1 class="hasAnchor">
<a href="#quick-start-running-the-fastqc-pipeline" class="anchor"></a>Quick start: running the FastQC pipeline</h1>
<p>I will go through the same tutorial again, but this time use a more simpler cascading API.</p>
<div id="create-an-auth-object" class="section level2">
<h2 class="hasAnchor">
<a href="#create-an-auth-object" class="anchor"></a>Create an Auth object</h2>
<p>First thing you do is to get your authentication token following this <a href="https://docs.sbgenomics.com/display/sbg/Managing+Account+Settings#ManagingAccountSettings-GenerateanAuthenticationToken">tutorial</a>, then create a <em>Auth</em> object which will be our master object for request and actions.</p>
<p>By default we are using SBG US platform API URL “<a href="https://api.sbgenomics.com/1.1/" class="uri">https://api.sbgenomics.com/1.1/</a>”, you can also pass another URL, for example, NCI cancer cloud API URL.</p>
<p>Now let’s use some fake auth token and load the library.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.sevenbridges.com">sbgr</a></span><span class="op">)</span>
<span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Auth-class.html">Auth</a></span><span class="op">(</span><span class="st">"aef7e9e3f6c54fb1b338ac4ecddf1a56"</span><span class="op">)</span>
<span class="va">a</span></code></pre></div>
<pre><code>## == Auth ==</code></pre>
<pre><code>## auth_token : aef7e9e3f6c54fb1b338ac4ecddf1a56</code></pre>
<pre><code>## url : https://api.sbgenomics.com/1.1/</code></pre>
</div>
<div id="billing-group" class="section level2">
<h2 class="hasAnchor">
<a href="#billing-group" class="anchor"></a>Billing group</h2>
<p>Billing group specify how your computation charges, when you first registered, you should have some free credit, with billing group called something like “Free Account”. Or maybe your company/organization purchased a license, you should have other billing group attached as well</p>
<p>To show how many billing group you belong too, just call <em>billing</em> function</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">b</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">$</span><span class="fu">billing</span><span class="op">(</span><span class="op">)</span>
<span class="va">b</span></code></pre></div>
</div>
<div id="create-a-project" class="section level2">
<h2 class="hasAnchor">
<a href="#create-a-project" class="anchor"></a>Create a project</h2>
<p>Let’s first list all projects you have under your account</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a</span><span class="op">$</span><span class="fu">project</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>You can search it by <code>name</code> or by <code>id</code>, <strong>note</strong>: <code>id</code> is unique, but <code>name</code> may have multiple hits, by default, we are using exact matching, only return it when it has single hits. There are two additional parameters to control it <code>exact</code> and <code>ignore.case</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a</span><span class="op">$</span><span class="fu">project</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"my first"</span><span class="op">)</span> <span class="co"># return one matching</span></code></pre></div>
<p>Maybe you want to create another project called “API” just for testing, but make sure you pass the required field <code>name</code>, <code>description</code> and <code>billing_group_id</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a</span><span class="op">$</span><span class="fu">project_new</span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"API"</span>, description <span class="op">=</span> <span class="st">"API tutorial"</span>,
  billing_group_id <span class="op">=</span> <span class="va">b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></code></pre></div>
</div>
<div id="upload-file-and-set-metadata" class="section level2">
<h2 class="hasAnchor">
<a href="#upload-file-and-set-metadata" class="anchor"></a>Upload file and set metadata</h2>
<p>To save your typing/lines for cascading style, I want to save the project I am gonna use for this tutorial to a Project object first.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## get the project we just created</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">$</span><span class="fu">project</span><span class="op">(</span><span class="st">"API"</span><span class="op">)</span></code></pre></div>
<p>To list all files in that project and search for a file, it’s also easy</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a</span><span class="op">$</span><span class="fu">project</span><span class="op">(</span><span class="st">"my first"</span><span class="op">)</span><span class="op">$</span><span class="fu">file</span><span class="op">(</span><span class="op">)</span>
<span class="va">a</span><span class="op">$</span><span class="fu">project</span><span class="op">(</span><span class="st">"my first"</span><span class="op">)</span><span class="op">$</span><span class="fu">file</span><span class="op">(</span><span class="st">"illumina"</span>, exact <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>Get the file we are going to upload and get the metadata ready as well.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"sample1.fastq"</span>, package <span class="op">=</span> <span class="st">"sbgr"</span><span class="op">)</span>
<span class="co">## create meta data</span>
<span class="va">fl.meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  file_type <span class="op">=</span> <span class="st">"fastq"</span>,
  seq_tech <span class="op">=</span> <span class="st">"Illumina"</span>,
  sample <span class="op">=</span> <span class="st">"sample1"</span>,
  author <span class="op">=</span> <span class="st">"tengfei"</span><span class="op">)</span></code></pre></div>
<p>To upload the file to the project, just call <code>upload</code> method from project object, it will initialize the multiparts automatically, checking each part and complete the call when finished. You will see the progress bar.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span><span class="op">$</span><span class="fu">upload</span><span class="op">(</span><span class="va">fl</span>, metadata <span class="op">=</span> <span class="va">fl.meta</span><span class="op">)</span></code></pre></div>
<pre><code>Initialized
|=============================================================================| 100%
== File ==
id : 55c90c73e4b01cacdc4fbf64
name : sample1.fastq
size : 16
-- metadata --
file_type : fastq
seq_tech : Illumina
sample : sample1
author: tengfei</code></pre>
<p>To check if it’s uploaded successfully, just check the file on the server to see if it exists or not.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span><span class="op">$</span><span class="fu">file</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html">basename</a></span><span class="op">(</span><span class="va">fl</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="keep-playing-with-file-metadata" class="section level3">
<h3 class="hasAnchor">
<a href="#keep-playing-with-file-metadata" class="anchor"></a>Keep playing with file metadata</h3>
<p>Metadata is designed with fixed fields in the GUI with fixed enum types for some fields, like file_type, to check what’s fixed, please do</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/FileTypeSingleEnum-class.html">Metadata</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## -- Metadata --</code></pre>
<pre><code>## file_type : NA</code></pre>
<pre><code>## qual_scale : NA</code></pre>
<pre><code>## seq_tech : NA</code></pre>
<pre><code>## sample :</code></pre>
<pre><code>## library :</code></pre>
<pre><code>## platform_unit :</code></pre>
<pre><code>## paired_end : NA</code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/FileTypeSingleEnum-class.html">Metadata</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">file_type</span></code></pre></div>
<pre><code>## An object of class "FileTypeSingleEnum"
## [1] NA
## Slot "levels":
##  [1] "text"            "binary"          "fasta"           "csfasta"        
##  [5] "fastq"           "qual"            "xsq"             "sff"            
##  [9] "bam"             "bam_index"       "illumina_export" "vcf"            
## [13] "sam"             "bed"             "archive"         "juncs"          
## [17] "gtf"             "gff"             "enlis_genome"    NA</code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="fu"><a href="../reference/FileTypeSingleEnum-class.html">Metadata</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">file_type</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "text"            "binary"          "fasta"           "csfasta"        
##  [5] "fastq"           "qual"            "xsq"             "sff"            
##  [9] "bam"             "bam_index"       "illumina_export" "vcf"            
## [13] "sam"             "bed"             "archive"         "juncs"          
## [17] "gtf"             "gff"             "enlis_genome"    NA</code></pre>
<p>To add more metadata items, you can pass more named list entries, and to keep original turn on parameter <code>append</code>.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span><span class="op">$</span><span class="fu">file</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html">basename</a></span><span class="op">(</span><span class="va">fl</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="fu">set_metadata</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>version <span class="op">=</span> <span class="st">"2.0"</span><span class="op">)</span>, append <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>Read more about metadata please visit SBG <a href="https://docs.sbgenomics.com/display/sbg/Metadata">developer hub page</a></p>
</div>
<div id="delete-a-file" class="section level3">
<h3 class="hasAnchor">
<a href="#delete-a-file" class="anchor"></a>Delete a file</h3>
<p>To delete a file, just call <code>delete</code> method on a <em>File</em> object. for example.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span><span class="op">$</span><span class="fu">file</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html">basename</a></span><span class="op">(</span><span class="va">fl</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="fu">delete</span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="get-pipelines-information" class="section level2">
<h2 class="hasAnchor">
<a href="#get-pipelines-information" class="anchor"></a>Get pipelines information</h2>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span><span class="op">$</span><span class="fu">pipeline</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>It’s a new project, there is no pipeline yet, there are several other ways to check out available pipelines for public, my pipeline and pipelines in particular project.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## project pipelines</span>
<span class="va">a</span><span class="op">$</span><span class="fu">project</span><span class="op">(</span><span class="st">"my first"</span><span class="op">)</span><span class="op">$</span><span class="fu">pipeline</span><span class="op">(</span><span class="op">)</span>
<span class="co">## all public pipeline</span>
<span class="va">a</span><span class="op">$</span><span class="fu">pipeline</span><span class="op">(</span><span class="op">)</span>
<span class="co">## my pipeline</span>
<span class="va">a</span><span class="op">$</span><span class="fu">pipeline</span><span class="op">(</span><span class="st">"my"</span><span class="op">)</span>
<span class="co">## particular project</span>
<span class="va">a</span><span class="op">$</span><span class="fu">pipeline</span><span class="op">(</span>project_name <span class="op">=</span> <span class="st">"my first"</span><span class="op">)</span></code></pre></div>
<p>Let’s look for a pipeline about “FastQC”, from public repos</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f.pipe</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">$</span><span class="fu">pipeline</span><span class="op">(</span>pipeline_name <span class="op">=</span> <span class="st">"FastQC"</span><span class="op">)</span>
<span class="va">f.pipe</span></code></pre></div>
<p>Cool, we got a unique hit, let’s copy the FastQC pipeline to the new project</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span><span class="op">$</span><span class="fu">pipeline_add</span><span class="op">(</span>pipeline_name <span class="op">=</span> <span class="va">f.pipe</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></code></pre></div>
<p>To confirm</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f.pipe</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">$</span><span class="fu">pipeline</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"FastQC"</span><span class="op">)</span>
<span class="va">f.pipe</span></code></pre></div>
</div>
<div id="run-a-task-with-the-pipeline" class="section level2">
<h2 class="hasAnchor">
<a href="#run-a-task-with-the-pipeline" class="anchor"></a>Run a task with the pipeline</h2>
<p>Please call <code>detail</code> function to check the required inputs, here I quote the SBG API <a href="https://docs.sbgenomics.com/display/developerhub/API%3A+Pipelines#API:Pipelines-Getpipelinedetails:GET/project/:project_id/pipeline/:pipeline_id">introduction</a></p>
<ul>
<li>
<strong>id</strong>: The ID number of the pipeline, used by the API to uniquely refer to it</li>
<li>
<strong>revision</strong>: The revision of the pipeline</li>
<li>
<strong>name</strong>: The human-readable name of the pipeline</li>
<li>
<strong>description</strong>: A short description of the pipeline’s function</li>
<li>
<strong>inputs</strong>: An array listing the pipeline’s input nodes, i.e. those pipeline apps which require files as input</li>
<li>
<strong>nodes</strong>: An array of intermediary nodes, representing the pipeline apps which transform the data. These may have editable parameters that should be set before running the pipeline, although in this particular pipeline example no parameters are editable.</li>
<li>
<strong>outputs</strong>: An array of output nodes, producing files, reports, visualizations, etc.</li>
</ul>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f.pipe</span><span class="op">$</span><span class="fu">details</span><span class="op">(</span><span class="op">)</span>
<span class="va">f.pipe</span><span class="op">$</span><span class="fu">details</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">inputs</span>
<span class="va">f.pipe</span><span class="op">$</span><span class="fu">details</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">nodes</span></code></pre></div>
<p>To run the pipeline, we need to provide task details, we know we want to input our upload sample file as input node here. So we need to link our file id with the input node id.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f.task</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">$</span><span class="fu">task_run</span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"my task"</span>,
  description <span class="op">=</span> <span class="st">"A text description"</span>,
  pipeline_id <span class="op">=</span> <span class="va">f.pipe</span><span class="op">$</span><span class="va">id</span>,
  inputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"177252"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">f.file</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">f.task</span></code></pre></div>
</div>
<div id="monitor-your-task" class="section level2">
<h2 class="hasAnchor">
<a href="#monitor-your-task" class="anchor"></a>Monitor your task</h2>
<p>Pass the interval time (in seconds) this will check status of a task, print finish when it’s finished.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f.task</span><span class="op">$</span><span class="fu">monitor</span><span class="op">(</span><span class="fl">30</span><span class="op">)</span></code></pre></div>
<p>Or simple call <code>details</code> method</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f.task</span><span class="op">$</span><span class="fu">details</span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="abort-a-task" class="section level2">
<h2 class="hasAnchor">
<a href="#abort-a-task" class="anchor"></a>Abort a task</h2>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f.task</span><span class="op">$</span><span class="fu">abort</span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="download-the-results" class="section level2">
<h2 class="hasAnchor">
<a href="#download-the-results" class="anchor"></a>Download the results</h2>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f.task</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">$</span><span class="fu">task</span><span class="op">(</span>id <span class="op">=</span> <span class="st">"fed9279b-8677-4eef-9c16-9135a457f53f"</span><span class="op">)</span>
<span class="va">f.task</span><span class="op">$</span><span class="fu">download</span><span class="op">(</span><span class="st">"~/Desktop/"</span><span class="op">)</span></code></pre></div>
</div>
<div id="wrap-the-example-up" class="section level2">
<h2 class="hasAnchor">
<a href="#wrap-the-example-up" class="anchor"></a>Wrap the example up</h2>
<p>Ok, the full script is something like</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://www.sevenbridges.com">"sbgr"</a></span><span class="op">)</span>
<span class="va">token</span> <span class="op">&lt;-</span> <span class="st">"aef7e9e3f6c54fb1b338ac4ecddf1a56"</span>
<span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Auth-class.html">Auth</a></span><span class="op">(</span><span class="va">token</span><span class="op">)</span>

<span class="co">## get billing info</span>
<span class="va">b</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">$</span><span class="fu">billing</span><span class="op">(</span><span class="op">)</span>

<span class="co">## create project</span>
<span class="va">a</span><span class="op">$</span><span class="fu">project_new</span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"API"</span>, description <span class="op">=</span> <span class="st">"API tutorial"</span>,
  billing_group_id <span class="op">=</span> <span class="va">b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">$</span><span class="fu">project</span><span class="op">(</span><span class="st">"API"</span><span class="op">)</span>

<span class="co">## get data</span>
<span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"sample1.fastq"</span>, package <span class="op">=</span> <span class="st">"sbgr"</span><span class="op">)</span>

<span class="co">## create meta data</span>
<span class="va">fl.meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  file_type <span class="op">=</span> <span class="st">"fastq"</span>,
  seq_tech <span class="op">=</span> <span class="st">"Illumina"</span>,
  sample <span class="op">=</span> <span class="st">"sample1"</span>,
  author <span class="op">=</span> <span class="st">"tengfei"</span><span class="op">)</span>

<span class="co">## upload data with metadata</span>
<span class="va">p</span><span class="op">$</span><span class="fu">upload</span><span class="op">(</span><span class="va">fl</span>, metadata <span class="op">=</span> <span class="va">fl.meta</span><span class="op">)</span>

<span class="co">## check uploading success</span>
<span class="va">f.file</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">$</span><span class="fu">file</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html">basename</a></span><span class="op">(</span><span class="va">fl</span><span class="op">)</span><span class="op">)</span>

<span class="co">## get the pipeline from public repos</span>
<span class="va">f.pipe</span> <span class="op">&lt;-</span> <span class="va">a</span><span class="op">$</span><span class="fu">pipeline</span><span class="op">(</span>pipeline_name <span class="op">=</span> <span class="st">"FastQC"</span><span class="op">)</span>

<span class="co">## copy the pipeline to your poject</span>
<span class="va">p</span><span class="op">$</span><span class="fu">pipeline_add</span><span class="op">(</span>pipeline_name <span class="op">=</span> <span class="va">f.pipe</span><span class="op">$</span><span class="va">name</span><span class="op">)</span>

<span class="co">## get the pipeline from your project not public one</span>
<span class="va">f.pipe</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">$</span><span class="fu">pipeline</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"FastQC"</span><span class="op">)</span>

<span class="co">## check the inputs needed for running tasks</span>
<span class="va">f.pipe</span><span class="op">$</span><span class="fu">details</span><span class="op">(</span><span class="op">)</span>

<span class="co">## Ready to run a task? go</span>
<span class="va">f.task</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">$</span><span class="fu">task_run</span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"my task"</span>,
  description <span class="op">=</span> <span class="st">"A text description"</span>,
  pipeline_id <span class="op">=</span> <span class="va">f.pipe</span><span class="op">$</span><span class="va">id</span>,
  inputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"177252"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">f.file</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">f.task</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="op">)</span>

<span class="co">## or you can just run with Task constructor</span>
<span class="va">f.task</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Task-class.html">Task</a></span><span class="op">(</span>
  auth <span class="op">=</span> <span class="fu"><a href="../reference/Auth-class.html">Auth</a></span><span class="op">(</span><span class="va">token</span><span class="op">)</span>,
  name <span class="op">=</span> <span class="st">"my task"</span>,
  description <span class="op">=</span> <span class="st">"A text description"</span>,
  pipeline_id <span class="op">=</span> <span class="va">f.pipe</span><span class="op">$</span><span class="va">id</span>,
  project_id <span class="op">=</span> <span class="va">p</span><span class="op">$</span><span class="va">id</span>,
  inputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"177252"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">f.file</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co">## Monitor you task</span>
<span class="va">f.task</span><span class="op">$</span><span class="fu">monitor</span><span class="op">(</span><span class="fl">30</span><span class="op">)</span>

<span class="co">## download a task output files</span>
<span class="va">f.task</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">$</span><span class="fu">task</span><span class="op">(</span><span class="st">"my task"</span><span class="op">)</span>
<span class="va">f.task</span><span class="op">$</span><span class="fu">download</span><span class="op">(</span><span class="st">"~/Desktop/"</span><span class="op">)</span>

<span class="co">## Abort the task</span>
<span class="va">f.task</span><span class="op">$</span><span class="fu">abort</span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nan Xiao, Tengfei Yin, Seven Bridges Genomics.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
